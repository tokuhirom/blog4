{{template "layout" .}}

{{define "title"}}Admin - Entry List{{end}}

{{define "nav-entries-active"}}class="active"{{end}}

{{define "content"}}
    <div class="admin-container entry-list-container">
        <div class="search-and-actions">
            <div class="search-box">
                <input
                    type="text"
                    name="q"
                    placeholder="Search entries..."
                    hx-get="/admin/entries/search"
                    hx-trigger="keyup changed delay:500ms, search"
                    hx-target="#entry-list"
                    hx-include="this"
                    autocomplete="off"
                />
            </div>
            <button class="btn-new-entry" id="btn-create-entry">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                New Entry
            </button>
        </div>

        <!-- Hidden form for creating new entry -->
        <form id="create-entry-form"
              hx-post="/admin/entries/create"
              style="display: none;">
            <input type="hidden" name="title" id="new-entry-title" value="">
        </form>

        <div id="entry-list" class="entry-grid">
            {{template "entry-cards" .}}
        </div>

        {{if .HasMore}}
        <div class="load-more">
            <button
                hx-get="/admin/entries/search?last_last_edited_at={{.LastCursor}}"
                hx-target="#entry-list"
                hx-swap="beforeend"
                hx-select=".entry-card">
                Load More
            </button>
        </div>
        {{end}}
    </div>
{{end}}

{{define "extra-scripts"}}
    <script>
        // Function to create new entry
        function createNewEntry() {
            // Generate timestamp-based title
            const now = new Date();
            const title = now.toISOString().slice(0,19).replace(/[-:]/g, '').replace('T', '');

            // Set title in hidden form field and trigger htmx submission
            document.getElementById('new-entry-title').value = title;
            htmx.trigger('#create-entry-form', 'submit');
        }

        // Button click handler
        document.getElementById('btn-create-entry').addEventListener('click', (e) => {
            e.preventDefault();
            createNewEntry();
        });
    </script>
{{end}}